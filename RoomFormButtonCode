using System.ComponentModel;

namespace RoomList
{
    public partial class Form1 : Form
    {
        private List<Room> roomList;


        public Form1()
        {
            InitializeComponent();
            this.Load += Form1_Load;
            txtCapacity.Leave += txtCapacity_Leave;
            txtCapacity.KeyDown += txtCapacity_KeyDown;

            listbxRoom.DisplayMember = "Name";
            listbxRoom.SelectedIndexChanged += listbxRoom_SelectedIndexChanged;

            //instantiate Wheldon class
            //retrieve room list
            roomList = new List<Room>();
        }
        private void Form1_Load(object sender, EventArgs e)
        {
            RefreshRoomListBox();

            var screenBounds = Screen.FromControl(this).Bounds;
            int midForm = screenBounds.X + screenBounds.Width / 2;

            // Center main controls
            lblRoom.Left = midForm - lblRoom.Width / 2;
            lblRoomList.Left = midForm - lblRoomList.Width / 2;
            listbxRoom.Left = midForm - listbxRoom.Width / 2;
            lblCapacity.Left = midForm - lblCapacity.Width / 2;
            txtCapacity.Left = midForm - txtCapacity.Width / 2;
            grpbxForms.Left = midForm - grpbxForms.Width / 2;

            // Position Exit button in top-right corner
            int rightOffset = 40;
            BtnExit.Left = this.ClientSize.Width - BtnExit.Width - rightOffset;
            BtnExit.Top = 20;

            // Position Save button at bottom-right of list box with spacing
            int saveHorizontalSpacing = 30;
            btnSave.Top = listbxRoom.Top + listbxRoom.Height - btnSave.Height;
            btnSave.Left = listbxRoom.Left + listbxRoom.Width + saveHorizontalSpacing;

            // Add Room â†’ above Edit Room, both left of list box
            int horizontalOffset = 60;   // shift left
            int verticalSpacing = 20;    // spacing between buttons

            BtnAddRoom.Left = listbxRoom.Left - BtnAddRoom.Width - horizontalOffset;
            BtnAddRoom.Top = listbxRoom.Top + listbxRoom.Height - BtnAddRoom.Height - 60; // raise higher

            BtnEditRoom.Left = BtnAddRoom.Left;
            BtnEditRoom.Top = BtnAddRoom.Top + BtnAddRoom.Height + verticalSpacing;

            // Re-center Add Room horizontally above Edit Room (minimal change)
            BtnAddRoom.Left = BtnEditRoom.Left + (BtnEditRoom.Width - BtnAddRoom.Width) / 2;
        }
        private void RefreshRoomListBox()
        {
            listbxRoom.DataSource = null;
            listbxRoom.DataSource = roomList;
            listbxRoom.DisplayMember = "Name";


        }
        private void listbxRoom_SelectedIndexChanged(object sender, EventArgs e)
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;
            txtCapacity.Text = selectedRoom != null ? selectedRoom.Capacity.ToString() : "";
        }
        private void BtnAddRoom_Click(object sender, EventArgs e)
        {
            string roomName = Microsoft.VisualBasic.Interaction.InputBox("Enter room name:", "Add Room", "");
            if (string.IsNullOrWhiteSpace(roomName)) return;

            string capacityInput = Microsoft.VisualBasic.Interaction.InputBox("Enter room capacity:", "Add Room", "");
            if (!int.TryParse(capacityInput, out int capacity) || capacity <= 0) return;

            // Add new room to the list
            roomList.Add(new Room { Name = roomName, Capacity = capacity });

            // Refresh ListBox to show the new room
            listbxRoom.DataSource = null;
            listbxRoom.DataSource = roomList;
            listbxRoom.DisplayMember = "Name";

            // Optionally select the newly added room
            listbxRoom.SelectedItem = roomList.Last();
            txtCapacity.Text = capacity.ToString();
        }

        private void BtnSaveCapacity_Click(object sender, EventArgs e)
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;
            if (selectedRoom == null) return;

            if (int.TryParse(txtCapacity.Text.Trim(), out int newCapacity) && newCapacity > 0)
            {
                selectedRoom.Capacity = newCapacity;
                RefreshRoomListBox();
                listbxRoom.SelectedItem = selectedRoom;
                MessageBox.Show($"Updated capacity for '{selectedRoom.Name}' to {newCapacity}.");
            }
            else
            {
                MessageBox.Show("Please enter a valid positive number for capacity.");
            }
        }
        private void txtCapacity_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Enter)
            {
                SaveCapacityFromTextbox();
                e.Handled = true;
                e.SuppressKeyPress = true; // Prevent ding sound
            }
        }
        private void txtCapacity_Leave(object sender, EventArgs e)
        {
            SaveCapacityFromTextbox();
        }
        private void SaveCapacityFromTextbox()
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;
            if (selectedRoom == null) return;

            if (int.TryParse(txtCapacity.Text.Trim(), out int newCapacity) && newCapacity > 0)
            {
                selectedRoom.Capacity = newCapacity;
                RefreshRoomListBox();
                listbxRoom.SelectedItem = selectedRoom;
            }
            else
            {
                MessageBox.Show("Please enter a valid positive number for capacity.");
                txtCapacity.Text = selectedRoom.Capacity.ToString(); // Revert to original
            }
        }

        private void RoomListbx_Click(object sender, EventArgs e)
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;

            if (selectedRoom != null)
            {
                txtCapacity.Text = $" {selectedRoom.Capacity}";
                txtCapacity.Text = selectedRoom.Capacity.ToString();
            }
            else
            {
                txtCapacity.Text = "";
            }
        }


        private void Form1_Load_1(object sender, EventArgs e)
        {

        }

        private void btnSave_Click(object sender, EventArgs e)
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;
            if (selectedRoom != null)
            {
                MessageBox.Show($"Room '{selectedRoom.Name}' with capacity {selectedRoom.Capacity} saved.");
            }
        }

        private void BtnEditRoom_Click(object sender, EventArgs e)
        {
            var selectedRoom = listbxRoom.SelectedItem as Room;
            if (selectedRoom == null) return;

            string newName = Microsoft.VisualBasic.Interaction.InputBox("Edit room name:", "Edit Room", selectedRoom.Name);
            if (string.IsNullOrWhiteSpace(newName)) return;

            string newCapacityInput = Microsoft.VisualBasic.Interaction.InputBox("Edit room capacity:", "Edit Room", selectedRoom.Capacity.ToString());
            if (!int.TryParse(newCapacityInput, out int newCapacity) || newCapacity <= 0) return;

            selectedRoom.Name = newName;
            selectedRoom.Capacity = newCapacity;

            RefreshRoomListBox();
            listbxRoom.SelectedItem = selectedRoom;
            txtCapacity.Text = newCapacity.ToString();
        }

        private void BtnExit_Click(object sender, EventArgs e)
        {
            Close();
        }
    }
}

